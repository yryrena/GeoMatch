# .github/workflows/ascii-guard.yml
name: ASCII guard

on:
  push:
  pull_request:

jobs:
  ascii-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fail on non-ASCII characters in non-binary files
        shell: bash
        run: |
          set -euo pipefail
          fail=0
 
          IGNORE_REGEX='^(\.git/|\.github/workflows/|docs/assets/|.*\.png$|.*\.jpg$)$'
 
          git ls-files -z | while IFS= read -r -d '' f; do 
            if [[ "$f" =~ $IGNORE_REGEX ]]; then
              continue
            fi
 
            if file -I "$f" | grep -q 'charset=binary'; then
              continue
            fi
 
            if LC_ALL=C grep -n "[^ -~]" "$f" >/dev/null; then
              echo "Non-ASCII found in: $f"
              fail=1
            fi
          done

          if [[ $fail -ne 0 ]]; then
            echo "CI failed: strip smart quotes / NBSP etc."
            exit 1
          fi